{% extends 'layout_left.html' %}
{% load static %} <!-- 必写,Django根据seting自动查找当前App静态文件 -->

{% block head %}
    <link href="{% static '/layui/css/layui.css' %}" type="text/css" rel="stylesheet">
{% endblock %}

{% block content %}
    <form class="layui-form" lay-filter="activityForm" method="post">
        {% csrf_token %}
        <div class="layui-form-item" id="add_info_div">

            <div class="layui-input-block">

            </div>
            <div class="layui-row layui-input-block">
                <div class="layui-inline">
                    <button type="button" class="layui-btn" id="addNewTemplateBtn" name="addNewTemplateBtn">
                        添加新一期活动模板
                    </button>
                </div>

                <div class="layui-inline">
                    <button type="button" class="layui-btn" id="activityRewardBtn" name="activityRewardBtn">
                        添加本期活动奖励
                    </button>
                </div>

                <div class="layui-inline">
                    <button type="button" class="layui-btn" id="addActivityBtn" name="addActivityBtn">添加一条活动
                    </button>
                </div>

                <div class="layui-inline">
                    <button type="button" class="layui-btn" id="addTaskBtn" name="addTaskBtn">添加一条任务
                    </button>
                </div>
            </div>

            <div class="layui-row layui-input-block">
                <div class="layui-col-md9">
                    <table class="layui-table" lay-even id="itemFormInfo">
                        <thead>
                        <tr>
                            <th>id</th>
                            <th>活动列表</th>
                            <th>道具id</th>
                            <th>活动开始时间</th>
                            <th>活动结束时间</th>
                            <th>操作</th>
                        </tr>
                        </thead>
                        <tbody id="activity_template_info"></tbody>
                    </table>
                </div>
                <div class="layui-col-md9">
                    <hr class="layui-border-red">
                </div>
            </div>


            <div class="layui-row layui-input-block">
                <div class="layui-col-md9">
                    <table class="layui-table" lay-even id="itemFormInfo">
                        <thead>
                        <tr>
                            <th>id</th>
                            <th>活动类型</th>
                            <th>道具名称</th>
                            <th>道具数量</th>
                            <th>兑换消耗</th>
                            <th>消耗数量</th>
                            <th>操作</th>
                        </tr>
                        </thead>
                        <tbody id="activity_reward_table"></tbody>
                    </table>
                </div>
                <div class="layui-col-md9">
                    <hr class="layui-border-red">
                </div>
            </div>


            <div class="layui-row layui-input-block">
                <div class="layui-col-md9">
                    <table class="layui-table" lay-even id="activityFormInfo">
                        <thead>
                        <tr>
                            <th>活动ID</th>
                            <th>活动标题</th>
                            <th>活动内容</th>
                            <th>活动类型</th>
                            <th>活动限制</th>
                            <th>捐赠掉落池</th>
                            <th>捐献最大等级</th>
                            <th>操作</th>
                        </tr>
                        </thead>
                        <tbody id="activity_info_table"></tbody>
                    </table>
                </div>

                <div class="layui-col-md9">
                    <hr class="layui-border-red">
                </div>
            </div>

            <div class="layui-row layui-input-block">
                <div class="layui-col-md9">
                    <table class="layui-table" lay-even id="activityLimitInfo">
                        <thead>
                        <tr>
                            <th>任务ID</th>
                            <th>任务类型</th>
                            <th>任务奖励</th>
                            <th>奖励数量</th>
                            <th>任务目标</th>
                            <th>累积/达到</th>
                            <th>操作</th>
                        </tr>
                        </thead>
                        <tbody id="activity_task_table"></tbody>
                    </table>
                </div>
            </div>

            <div class="layui-input-block">

            </div>

            <div class="layui-form-item">
                <div class="layui-input-block">
                    <button class="layui-btn" type="submit" lay-submit lay-filter="btnSubmit" id="btnSubmit">
                        发布本期活动
                    </button>
                    <button type="reset" class="layui-btn layui-btn-primary" id="resetForm">取消</button>
                </div>
            </div>
        </div>
    </form>

    <form class="layui-form" id="addActivityTemplate" lay-filter="addActivityTemplate" method="post"
          style="display: none;" name="addActivityTemplate">
        <div class="layui-form-item" id="add_info_div">

            <div class="layui-input-block">

            </div>
            <div class="layui-input-block">
                <div class="layui-col-xs6 layui-col-sm6 layui-col-md3">
                    <div class="grid-demo grid-demo-bg1">
                        请选择本期道具：<select id="templateItem" name="templateItem"
                                        lay-filter="templateItem" lay-search>
                        <option value="" name='itemName'></option>
                    </select>
                    </div>
                </div>


                <div class="layui-col-xs6 layui-col-sm6 layui-col-md3">
                    确定：
                    <div class="grid-demo grid-demo-bg1">
                        <button type="button" class="layui-btn" id="addTemplateItem" name="addTemplateItem">确定
                        </button>
                    </div>
                </div>
            </div>

            <div class="layui-row layui-input-block">
                <div class="layui-col-md9">
                    <table class="layui-table" lay-even id="activityExtAttrInfo">
                        <thead>
                        <tr>
                            <th>ID</th>
                            <th>本期道具</th>
                            <th>操作</th>
                        </tr>
                        </thead>
                        <tbody id="template_table"></tbody>
                    </table>
                </div>
            </div>


            <div class="layui-input-block">

            </div>


            <div class="layui-input-block">
                <div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
                    选择本期活动开放类型：
                </div>
            </div>

            <div class="layui-row layui-input-block">
                <div class="layui-col-xs6 layui-col-sm6 layui-col-md2">
                    <div class="grid-demo grid-demo-bg1">
                        <input type="checkbox" id="activityTask" title="开服任务">
                    </div>
                </div>

                <div class="layui-col-xs6 layui-col-sm6 layui-col-md2">
                    <div class="grid-demo grid-demo-bg1">
                        <input type="checkbox" id="activityGive" title="捐赠">
                    </div>
                </div>

                <div class="layui-col-xs6 layui-col-sm6 layui-col-md2">
                    <div class="grid-demo grid-demo-bg1">
                        <input type="checkbox" id="activityFalling" title="掉落">
                    </div>
                </div>

                <div class="layui-col-xs6 layui-col-sm6 layui-col-md2">
                    <div class="grid-demo grid-demo-bg1">
                        <input type="checkbox" id="activityExchange" title="兑换">
                    </div>
                </div>
            </div>

            <div class="layui-input-block">

            </div>
            <div class="layui-row layui-input-block">
                <div class="layui-col-md9">
                    选择时间：<input type="text" class="layui-input" id="timeScope"
                                placeholder="yyyy-MM-dd HH:mm:ss~yyyy-MM-dd HH:mm:ss">
                </div>
            </div>
            <div class="layui-input-block">

            </div>

            <div class="layui-form-item">
                <div class="layui-input-block">
                    <button class="layui-btn" type="button" lay-submit id="activityTemplateBtn">
                        提交
                    </button>
                    <button type="reset" class="layui-btn layui-btn-primary" id="activityTemplateReset">取消</button>
                </div>
            </div>

        </div>
    </form>

    <form class="layui-form" id="addRewardForm" lay-filter="addRewardForm" method="post" style="display: none;">
        <div class="layui-row layui-input-block">
            <div class="layui-col-xs6 layui-col-sm6 layui-col-md4">
                <div class="grid-demo grid-demo-bg1">
                    选择活动类型： <select name="" id="rewardActivityType" lay-filter="rewardActivityType">
                    <option value="" name='rewardActivityType'></option>
                </select>
                </div>
            </div>
            <div class="layui-col-xs6 layui-col-sm6 layui-col-md4">
                <div class="grid-demo grid-demo-bg1">
                    请选择道具：<select id="allItemName" name="allItemName" lay-verify="required"
                                  lay-filter="allItemName" lay-search>
                    <option value="" name='itemName'></option>
                </select>
                </div>
            </div>
            <div class="layui-col-xs6 layui-col-sm6 layui-col-md2">
                <div class="grid-demo grid-demo-bg1">
                    请输入道具数量：<input type="text" name="rewardCount" autocomplete="off"
                                   id="rewardCount"
                                   placeholder="输入道具数量"
                                   class="layui-input"
                                   onkeyup="if(this.value.length==1){this.value=this.value.replace(/[^1-9]/g,'')}else{this.value=this.value.replace(/\D/g,'')}"
                                   onafterpaste="if(this.value.length==1){this.value=this.value.replace(/[^1-9]/g,'')}else{this.value=this.value.replace(/\D/g,'')}">
                </div>
            </div>

            <div class="layui-col-xs6 layui-col-sm6 layui-col-md4">
                <div class="grid-demo grid-demo-bg1">
                    选择兑换消耗类型： <select name="" id="exchangeTypeItem" lay-filter="exchangeTypeItem">
                    <option value="" name='itemName'></option>
                </select>
                </div>
            </div>
            <div class="layui-col-xs6 layui-col-sm6 layui-col-md4">
                <div class="grid-demo grid-demo-bg1">
                    请输入兑换消耗数量：<input type="text" name="itemCount" autocomplete="off"
                                     id="exchangeCount"
                                     placeholder="输入道具数量"
                                     class="layui-input"
                                     readonly="true"
                                     onkeyup="if(this.value.length==1){this.value=this.value.replace(/[^1-9]/g,'')}else{this.value=this.value.replace(/\D/g,'')}"
                                     onafterpaste="if(this.value.length==1){this.value=this.value.replace(/[^1-9]/g,'')}else{this.value=this.value.replace(/\D/g,'')}">
                </div>
            </div>


            <div class="layui-col-xs4 layui-col-sm12 layui-col-md4">
                <div class="grid-demo grid-demo-bg1">
                    <div>
                        确定：
                        <button type="button" class="layui-btn" id="rewardBtn" name="rewardBtn">
                            {#  activityBtn #}
                            确定
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="layui-row layui-input-block">
            <div class="layui-col-md9">
                <table class="layui-table" lay-even id="itemFormInfo">
                    <thead>
                    <tr>
                        <th>id</th>
                        <th>活动类型</th>
                        <th>道具名称</th>
                        <th>道具数量</th>
                        <th>兑换消耗</th>
                        <th>消耗数量</th>
                        <th>操作</th>
                    </tr>
                    </thead>
                    <tbody id="activity_reward_table1"></tbody>
                </table>
            </div>
        </div>


        <div class="layui-input-block">

        </div>

        <div class="layui-form-item">
            <div class="layui-input-block">
                <button class="layui-btn" type="button" id="addActivityRewardBtn">
                    提交
                </button>
                <button type="reset" class="layui-btn layui-btn-primary" id="activityRewardReset">取消</button>
            </div>
        </div>
    </form>

    <form class="layui-form" id="addActivityForm" lay-filter="addActivityForm" method="post" style="display: none;">
        <div class="layui-form-item" id="add_info_div">


            <div class="layui-input-block">

            </div>
            <div class="layui-input-block">
                <div class="grid-demo grid-demo-bg1">
                    请输入活动标题：<input type="text" name="activityTitle" autocomplete="off"
                                   id="activityTitle"
                                   placeholder="输入活动标题"
                                   class="layui-input">
                </div>
            </div>

            <div class="layui-input-block">

            </div>
            <div class="layui-input-block">
                <div class="grid-demo grid-demo-bg1">
                    请输入活动内容：<textarea type="text" name="activityText" autocomplete="off"
                                      id="activityText"
                                      placeholder="输入活动内容"
                                      class="layui-textarea"></textarea>
                </div>
            </div>

            <div class="layui-input-block">

            </div>

            <div class="layui-row layui-input-block">
                <div class="layui-col-xs6 layui-col-sm6 layui-col-md3">
                    <div class="grid-demo grid-demo-bg1">
                        选择类型： <select name="activityInfoType" id="activityInfoType" lay-filter="activityInfoType">
                        <option value="" name='activityType'></option>
                    </select>
                    </div>
                </div>

                <div class="layui-col-xs6 layui-col-sm6 layui-col-md3">
                    <div class="grid-demo grid-demo-bg1">
                        请选择活动限制：<select id="receiveLimit" name="receiveLimit" lay-verify="required"
                                        lay-filter="receiveLimit" lay-search>
                        <option value="" name='limitType'></option>
                    </select>
                    </div>
                </div>
                <div class="layui-col-xs6 layui-col-sm6 layui-col-md2">
                    <div class="grid-demo grid-demo-bg1">
                        请输入限制数量：<input type="text" name="limitCount" autocomplete="off"
                                       id="limitCount"
                                       placeholder="输入限制数量"
                                       class="layui-input"
                                       onkeyup="if(this.value.length==1){this.value=this.value.replace(/[^1-9]/g,'')}else{this.value=this.value.replace(/\D/g,'')}"
                                       onafterpaste="if(this.value.length==1){this.value=this.value.replace(/[^1-9]/g,'')}else{this.value=this.value.replace(/\D/g,'')}">
                    </div>

                </div>
                <div class="layui-col-xs6 layui-col-sm6 layui-col-md3">
                    确定活动限制：
                    <div class="grid-demo grid-demo-bg1">
                        <button type="button" class="layui-btn" id="addActivityLimit" name="addActivityLimit">确定活动限制
                        </button>
                    </div>
                </div>

                <div class="layui-input-block">

                </div>
            </div>

            <div class="layui-row layui-input-block">
                <div class="layui-col-md9">
                    <table class="layui-table" lay-even id="activityLimitInfo">
                        <thead>
                        <tr>
                            <th>ID</th>
                            <th>活动限制</th>
                            <th>活动数量</th>
                            <th>操作</th>
                        </tr>
                        </thead>
                        <tbody id="activity_limit_table"></tbody>
                    </table>
                </div>
            </div>

            <div class="layui-input-block">

            </div>

            <div class="layui-row layui-input-block">
                <div class="layui-col-xs6 layui-col-sm6 layui-col-md3">
                    <div class="grid-demo grid-demo-bg1">
                        <button type="button" class="layui-btn" id="addActivityGroup" name="addActivityGroup">添加捐赠、掉落池子
                        </button>
                    </div>
                </div>
                <div class="layui-input-block">

                </div>
            </div>

            <div class="layui-input-block">

            </div>

            <div class="layui-row layui-input-block">
                <div class="layui-col-md9">
                    <table class="layui-table" lay-even id="activityLimitInfo">
                        <thead>
                        <tr>
                            <th>ID</th>
                            <th>捐赠、掉落池子</th>
                            <th>捐献：兑换单独等级</th>
                            <th>操作</th>
                        </tr>
                        </thead>
                        <tbody id="activity_limit_group"></tbody>
                    </table>
                </div>
            </div>

            <div class="layui-input-block">

            </div>

            <div class="layui-form-item">
                <div class="layui-input-block">
                    <button class="layui-btn" type="button" id="limitBtn">
                        提交
                    </button>
                    <button type="reset" class="layui-btn layui-btn-primary" id="resetForm">取消</button>
                </div>
            </div>

        </div>
    </form>

    <form class="layui-form" id="addActivityExtAttr" lay-filter="addActivityExtAttr" method="post"
          style="display: none;" name="addActivityExtAttr">
        <div class="layui-form-item" id="add_info_div">

            <div class="layui-input-block">

            </div>

            <div class="layui-row layui-input-block">
                <div class="layui-col-xs6 layui-col-sm6 layui-col-md3">
                    <div class="grid-demo grid-demo-bg1">
                        请选择道具：<select id="extAttrItemName" name="extAttrItemName"
                                      lay-filter="extAttrItemName" lay-search>
                        <option value="" name='itemName'></option>
                    </select>
                    </div>
                </div>

                <div class="layui-col-xs6 layui-col-sm6 layui-col-md2">
                    <div class="grid-demo grid-demo-bg1">
                        请输入捐赠数量：<input type="text" name="extAttrCount" autocomplete="off"
                                       id="extAttrCount"
                                       placeholder="请输入捐赠数量"
                                       class="layui-input"
                                       onkeyup="if(this.value.length==1){this.value=this.value.replace(/[^1-9]/g,'')}else{this.value=this.value.replace(/\D/g,'')}"
                                       onafterpaste="if(this.value.length==1){this.value=this.value.replace(/[^1-9]/g,'')}else{this.value=this.value.replace(/\D/g,'')}">
                    </div>
                </div>

                <div class="layui-col-xs6 layui-col-sm6 layui-col-md2">
                    <div class="grid-demo grid-demo-bg1">
                        请输入随机数量：<input type="text" name="extAttrRandomCount" autocomplete="off"
                                       id="extAttrRandomCount"
                                       placeholder="请输入随机数量"
                                       class="layui-input"
                                       onkeyup="if(this.value.length==1){this.value=this.value.replace(/[^1-9]/g,'')}else{this.value=this.value.replace(/\D/g,'')}"
                                       onafterpaste="if(this.value.length==1){this.value=this.value.replace(/[^1-9]/g,'')}else{this.value=this.value.replace(/\D/g,'')}">
                    </div>
                </div>

                <div class="layui-col-xs6 layui-col-sm6 layui-col-md2">
                    <div class="grid-demo grid-demo-bg1">
                        请输入最大数量：<input type="text" name="extAttrMaxCount" autocomplete="off"
                                       id="extAttrMaxCount"
                                       placeholder="请输入最大数量"
                                       class="layui-input"
                                       onkeyup="if(this.value.length==1){this.value=this.value.replace(/[^1-9]/g,'')}else{this.value=this.value.replace(/\D/g,'')}"
                                       onafterpaste="if(this.value.length==1){this.value=this.value.replace(/[^1-9]/g,'')}else{this.value=this.value.replace(/\D/g,'')}">
                    </div>
                </div>

                <div class="layui-col-xs6 layui-col-sm6 layui-col-md3">
                    确定：
                    <div class="grid-demo grid-demo-bg1">
                        <button type="button" class="layui-btn" id="addExtAttr" name="addExtAttr">确定
                        </button>
                    </div>
                </div>
            </div>

            <div class="layui-row layui-input-block">
                <div class="layui-col-md9">
                    <table class="layui-table" lay-even id="activityExtAttrInfo">
                        <thead>
                        <tr>
                            <th>ID</th>
                            <th>捐赠道具</th>
                            <th>道具数量</th>
                            <th>操作</th>
                        </tr>
                        </thead>
                        <tbody id="activity_extAttr_table"></tbody>
                    </table>
                </div>
            </div>

            <div class="layui-row layui-input-block">
                <div class="layui-col-xs6 layui-col-sm6 layui-col-md3">
                    <div class="grid-demo grid-demo-bg1">
                        <button type="button" class="layui-btn" id="addGroup" name="addGroup">
                            确定以上数据为一个捐赠池
                        </button>
                    </div>

                </div>
                <div class="layui-input-block">

                </div>
            </div>

            <div class="layui-input-block">

            </div>

            <div class="layui-row layui-input-block">
                <div class="layui-col-md9">
                    <table class="layui-table" lay-even id="activityGroupTable">
                        <thead>
                        <tr>
                            <th>捐赠、掉落池子</th>
                            <th>捐献：兑换单独等级</th>
                            <th>操作</th>
                        </tr>
                        </thead>
                        <tbody id="activity_group_table"></tbody>
                    </table>
                </div>
            </div>

            <div class="layui-input-block">

            </div>
            <div class="layui-row layui-input-block">
                <div class="layui-col-xs6 layui-col-sm6 layui-col-md4">
                    <div class="grid-demo grid-demo-bg1">
                        请输入捐赠单独兑换等级：<input type="text" name="extAttrLv" autocomplete="off"
                                           id="extAttrLv"
                                           placeholder="请输入捐赠单独兑换等级"
                                           class="layui-input"
                                           onkeyup="if(this.value.length==1){this.value=this.value.replace(/[^1-9]/g,'')}else{this.value=this.value.replace(/\D/g,'')}"
                                           onafterpaste="if(this.value.length==1){this.value=this.value.replace(/[^1-9]/g,'')}else{this.value=this.value.replace(/\D/g,'')}">
                    </div>
                </div>
            </div>

            <div class="layui-input-block">

            </div>

            <div class="layui-form-item">
                <div class="layui-input-block">
                    <button class="layui-btn" type="button" lay-submit id="extAttrBtn">
                        提交1
                    </button>
                    <button type="reset" class="layui-btn layui-btn-primary" id="resetForm">取消</button>
                </div>
            </div>

        </div>
    </form>



    <form class="layui-form" id="addTaskForm" lay-filter="addTaskForm" method="post"
          style="display: none;" name="addTaskForm">

        <div class="layui-input-block">

        </div>

        <div class="layui-row layui-input-block">
            <div class="layui-col-xs6 layui-col-sm6 layui-col-md4">
                <div class="grid-demo grid-demo-bg1">
                    选择奖励道具： <select name="" id="taskRewardName" lay-filter="taskRewardName">
                    <option value="" name='taskRewardName'></option>
                </select>
                </div>
            </div>

            <div class="layui-col-xs6 layui-col-sm6 layui-col-md4">
                <div class="grid-demo grid-demo-bg1">
                    输入奖励数量：<input type="text" name="taskRewardCount" autocomplete="off"
                                  id="taskRewardCount"
                                  placeholder="输入奖励数量"
                                  class="layui-input"
                                  onkeyup="if(this.value.length==1){this.value=this.value.replace(/[^1-9]/g,'')}else{this.value=this.value.replace(/\D/g,'')}"
                                  onafterpaste="if(this.value.length==1){this.value=this.value.replace(/[^1-9]/g,'')}else{this.value=this.value.replace(/\D/g,'')}">
                </div>
            </div>

            <div class="layui-col-xs6 layui-col-sm6 layui-col-md4">
                确定奖励：
                <div class="grid-demo grid-demo-bg1">
                    <button type="button" class="layui-btn" id="addTaskReward" name="addTaskReward">确定奖励
                    </button>
                </div>
            </div>

            <div class="layui-input-block">

            </div>
        </div>

        <div class="layui-row layui-input-block">
            <div class="layui-col-md9">
                <table class="layui-table" lay-even id="activityLimitInfo">
                    <thead>
                    <tr>
                        <th>ID</th>
                        <th>奖励道具</th>
                        <th>道具数量</th>
                        <th>操作</th>
                    </tr>
                    </thead>
                    <tbody id="activity_task_reward_table"></tbody>
                </table>
            </div>
        </div>

        <div class="layui-input-block">

        </div>

        <div class="layui-row layui-input-block">
            <div class="layui-col-xs6 layui-col-sm6 layui-col-md3">
                <div class="grid-demo grid-demo-bg1">
                    选择任务类型： <select name="taskTypeInfo" id="taskTypeInfo" lay-filter="taskTypeInfo">
                    <option value="" name="taskTypeInfo">请选择任务类型</option>
                </select>
                </div>
            </div>

            <div class="layui-col-xs6 layui-col-sm6 layui-col-md3">
                <div class="grid-demo grid-demo-bg1">
                    解锁天数：<input type="text" name="taskDay" autocomplete="off"
                                id="taskDay"
                                placeholder="输入解锁天数"
                                class="layui-input"
                                onkeyup="if(this.value.length==1){this.value=this.value.replace(/[^1-9]/g,'')}else{this.value=this.value.replace(/\D/g,'')}"
                                onafterpaste="if(this.value.length==1){this.value=this.value.replace(/[^1-9]/g,'')}else{this.value=this.value.replace(/\D/g,'')}">
                </div>
            </div>

            <div class="layui-col-xs6 layui-col-sm6 layui-col-md3">
                <div class="grid-demo grid-demo-bg1">
                    任务所达到数值：<input type="text" name="taskNum" autocomplete="off"
                                   id="taskNum"
                                   placeholder="等级或者场次等"
                                   class="layui-input"
                                   onkeyup="if(this.value.length==1){this.value=this.value.replace(/[^1-9]/g,'')}else{this.value=this.value.replace(/\D/g,'')}"
                                   onafterpaste="if(this.value.length==1){this.value=this.value.replace(/[^1-9]/g,'')}else{this.value=this.value.replace(/\D/g,'')}">
                </div>
            </div>
            <div class="layui-col-xs6 layui-col-sm6 layui-col-md2">
                <div class="grid-demo grid-demo-bg1">
                    选择任务累积/达到： <select name="taskIsStorage" id="taskIsStorage" lay-filter="taskIsStorage">
                    <option value="0">累积</option>
                    <option value="1">达到</option>
                </select>
                </div>
            </div>

        </div>


        <div class="layui-input-block">

        </div>

        <div class="layui-form-item">
            <div class="layui-input-block">
                <button class="layui-btn" type="button" lay-submit id="taskInfoBtn">
                    提交
                </button>
                <button type="reset" class="layui-btn layui-btn-primary" id="taskInfoBtnReset">取消</button>
            </div>
        </div>

    </form>

    <table class="layui-hide" id="activation" lay-filter="activation"></table>

{% endblock %}

{% block js %}

    {#    <script type="text/html" id="toolbarDemo">#}
    {#        <div class="layui-btn-container">#}
    {#            <button class="layui-btn layui-btn-sm" lay-event="add">新增活动任务</button>#}
    {#        </div>#}
    {#    </script>#}
    {##}
    {#    <script type="text/html" id="barDemo">#}
    {#        <a class="layui-btn layui-btn-primary layui-btn-xs" lay-event="detail">查看</a>#}
    {#    </script>#}

    <script src="{% static 'layui/layui.js' %}" charset="utf-8"></script>
    <!-- 注意：如果你直接复制所有代码到本地，上述 JS 路径需要改成你本地的 -->
    <script>

        layui.use(['form', 'table', "laydate", 'layer'], function () {
            var table = layui.table;
            var form = layui.form;
            var layer = layui.layer;
            var laydate = layui.laydate;
            var $ = layui.$;

            // 第二步 监听父级，每当父级发生变化时，渲染子级的值
            form.on('select(exchangeTypeItem)', function (data) {
                var exchangeTypeItem = data.value;
                if (parseInt(exchangeTypeItem) > 0) {
                    $('#selectItemName').attr('disabled', 'true')
                    form.render('select');
                }
            });


            var itemInfo = JSON.parse(window.localStorage.activityItemInfo);
            // 下拉框
            let str = "<option value='' name='itemName'></option>";
            for (let i of itemInfo) {
                //组装数据
                str += "<option value='" + i.itemId + "' name='itemName'>" + i.itemId + ":" + i.name + "</option>";
            }
            //jquery赋值方式
            $("#selectItemName").html(str);
            $("#templateItem").html(str);


            var taskTypeInfo = JSON.parse(window.localStorage.taskTypeInfo);
            // 下拉框
            let taskStr = "<option value='' name='taskType'></option>";
            for (let i of taskTypeInfo) {
                //组装数据
                taskStr += "<option value='" + i.taskType + "' name='taskType'>" + i.taskText + "</option>";
            }
            //jquery赋值方式
            $("#taskTypeInfo").html(taskStr);


            var allItemInfo = JSON.parse(window.localStorage.itemInfo);
            // 下拉框
            let allItem = "<option value='' name='allItemName'></option>";
            for (let i of allItemInfo) {
                //组装数据
                allItem += "<option value='" + i.itemId + "' name='itemName'>" + i.itemId + ":" + i.name + "</option>";
            }
            //jquery赋值方式
            $("#allItemName").html(allItem);
            //重新渲染生效
            form.render();
            form.on('select(activityInfoType)', function (data) {
                $('#addActivityGroup').addClass("layui-btn-disabled").attr("disabled", true);
                var activityType = data.value;
                if (parseInt(activityType) === 2) {
                    $('#addActivityGroup').removeClass("layui-btn-disabled").attr("disabled", false);
                    let limitStr = "<option value='' name='itemName'></option>";
                    for (var e = 0; e < Object.values(templateInfo)[0].extAttr.length; e++) {
                        //组装数据
                        limitStr += "<option value='" + Object.values(templateInfo)[0].extAttr[e] + "' name='itemName'>" + Object.values(templateInfo)[0].extAttr[e] + ":" + Object.values(templateInfo)[0].extAttrName[e] + "</option>";
                    }

                    //jquery赋值方式
                    $("#receiveLimit").html(limitStr);
                    form.render();
                } else if (parseInt(activityType) === 3) {
                    $('#addActivityGroup').removeClass("layui-btn-disabled").attr("disabled", false);
                    let limitStr = "<option value='' name='itemName'></option>"
                    var rankInfo = [{"rankType": 1, "rankName": "排位:1"}, {
                        "rankType": 2,
                        "rankName": "合作"
                    }, {"rankType": 3, "rankName": "契约:3"}]
                    for (let i of rankInfo) {
                        //组装数据
                        limitStr += "<option value='" + i.rankType + "' name='itemName'>" + i.rankName + "</option>";
                    }
                    $("#receiveLimit").html(limitStr);
                    form.render();
                } else {
                    let limitStr = "<option value='' name='itemName'></option>"
                    var rewardValue = Object.values(rewardInfo)
                    for (var i = 0; i < rewardValue.length; i++) {
                        if (parseInt(activityType) === parseInt(rewardValue[i].activityType)) {
                            limitStr += "<option value='" + i + 1 + "' name='itemName'>" + "奖励id" + ":" + Object.keys(rewardInfo)[i] + "</option>";
                        }
                    }
                    $("#receiveLimit").html(limitStr);
                    form.render();
                }
            })


            var myDate = new Date();
            laydate.render({
                elem: '#timeScope'
                , type: 'datetime'
                , range: '~'
                , format: 'yyyy-M-d H:m:s'
                , min: myDate.toLocaleString()
            });

            {#var li = []#}
            {#var ln = []#}
            var templateItemInfo = {}
            $("#addTemplateItem").on("click", function () {
                var mayselect = document.getElementById("templateItem")
                var index = mayselect.selectedIndex
                var itemIdName = mayselect.options[index].text
                {#var itemName = itemIdName.substr(itemIdName.indexOf(":") + 1, itemIdName.length)#}
                var itemName = itemIdName.split(":")[1]
                var itemId = itemIdName.split(":")[0]
                for (let i of Object.keys(templateItemInfo)) {
                    if (i === itemId) {
                        alert("不可重复选择")
                        return false
                    }
                }
                if (itemIdName === "") {
                    alert("请选择道具")
                    return false
                } else {
                    templateItemInfo[itemId] = {
                        "tItemId": itemId,
                        "tItemName": itemName,
                    }

                    $(document).ready(function () {

                        var templateVal = Object.values(templateItemInfo);
                        var tbody = document.getElementById('template_table');
                        var trow = getDataRow(templateVal[templateVal.length - 1]); //定义一个方法,返回tr数据
                        tbody.appendChild(trow);

                    })

                    function getDataRow(h) {
                        var row = document.createElement('tr'); //创建行

                        var tIdCell = document.createElement('td'); //创建第一列id
                        tIdCell.innerHTML = h.tItemId; //填充数据
                        row.appendChild(tIdCell); //加入行  ，下面类似

                        var tNameCell = document.createElement('td');//创建第二列name
                        tNameCell.innerHTML = h.tItemName;
                        row.appendChild(tNameCell);

                        //到这里，json中的数据已经添加到表格中，下面为每行末尾添加删除按钮

                        var delCell = document.createElement('td');//创建第四列，操作列
                        row.appendChild(delCell);
                        var btnDel = document.createElement('input'); //创建一个input控件
                        btnDel.setAttribute('type', 'button'); //type="button"
                        btnDel.setAttribute('value', '删除');
                        btnDel.setAttribute('class', "layui-btn layui-btn-sm layui-btn-danger");

                        //删除操作
                        btnDel.onclick = function () {
                            if (confirm("确定删除这一行嘛？")) {
                                //找到按钮所在行的节点，然后删掉这一行
                                var c = JSON.stringify(this.parentNode.parentNode.innerText)
                                var tId = c.substring(c.indexOf('"') + 1, c.indexOf("\\t"))

                                delete templateItemInfo[tId]
                                this.parentNode.parentNode.parentNode.removeChild(this.parentNode.parentNode);
                            }
                        }
                        delCell.appendChild(btnDel);  //把删除按钮加入td，别忘了

                        return row; //返回tr数据

                    }
                }
            })

            var templateInfo = {}
            var t = 0
            $("#activityTemplateBtn").on('click', function () {
                var activityTaskCheck = document.getElementById("activityTask").checked
                var giveCheck = document.getElementById("activityGive").checked
                var fallingCheck = document.getElementById("activityFalling").checked
                var exchangeCheck = document.getElementById("activityExchange").checked
                var tTime = $("#timeScope").val()
                var tActivityType = []
                var tActivityName = []
                var templateItemName = []
                t++
                for (var n = 0; n < Object.values(templateItemInfo).length; n++) {
                    templateItemName.push(Object.values(templateItemInfo)[n].tItemName)
                }

                if (activityTaskCheck === true) {
                    tActivityType.push(1)
                    tActivityName.push("活动任务")
                }
                if (giveCheck === true) {
                    tActivityType.push(2)
                    tActivityName.push("捐赠")
                }
                if (fallingCheck === true) {
                    tActivityType.push(3)
                    tActivityName.push("掉落")
                }
                if (exchangeCheck === true) {
                    tActivityType.push(4)
                    tActivityName.push("兑换")
                }

                if (activityTaskCheck === false && giveCheck === false && fallingCheck === false && exchangeCheck === false) {
                    alert("未选择本期活动开放类型")
                    return false
                } else if (tTime === "") {
                    alert("时间不能为空")
                    return false
                } else if (Object.keys(templateItemInfo).length <= 0) {
                    alert("未选择本期活动道具")
                } else {
                    templateInfo[t] = {
                        "activityList": tActivityType,
                        "activityListName": tActivityName,
                        "extAttr": Object.keys(templateItemInfo),
                        "extAttrName": templateItemName,
                        "startTime": tTime.split("~")[0],
                        "endTime": tTime.split("~")[1],
                    }


                    $(document).ready(function () {

                        var activityTemplateVal = Object.values(templateInfo);
                        var tbody = document.getElementById('activity_template_info');
                        var template = getDataRow(activityTemplateVal[activityTemplateVal.length - 1], t); //定义一个方法,返回tr数据
                        tbody.appendChild(template);

                    })

                    function getDataRow(template,) {
                        var row = document.createElement('tr'); //创建行

                        var TIDCell = document.createElement('td'); //创建第一列id
                        TIDCell.innerHTML = t; //填充数据
                        row.appendChild(TIDCell); //加入行  ，下面类似

                        var tListCell = document.createElement('td');//创建第二列name
                        tListCell.innerHTML = template.activityListName;
                        row.appendChild(tListCell);

                        var extAttrNameCell = document.createElement('td');//创建第二列name
                        extAttrNameCell.innerHTML = template.extAttrName;
                        row.appendChild(extAttrNameCell);

                        var startTimeCell = document.createElement('td');//创建第二列name
                        startTimeCell.innerHTML = template.startTime;
                        row.appendChild(startTimeCell);

                        var endTimeCell = document.createElement('td');//创建第二列name
                        endTimeCell.innerHTML = template.endTime;
                        row.appendChild(endTimeCell);
                        //到这里，json中的数据已经添加到表格中，下面为每行末尾添加删除按钮

                        var delCell = document.createElement('td');//创建第四列，操作列
                        row.appendChild(delCell);
                        var btnDel = document.createElement('input'); //创建一个input控件
                        btnDel.setAttribute('type', 'button'); //type="button"
                        btnDel.setAttribute('value', '删除');
                        btnDel.setAttribute('class', "layui-btn layui-btn-sm layui-btn-danger");

                        //删除操作
                        btnDel.onclick = function () {
                            if (Object.keys(rewardInfo).length > 0) {
                                alert("本期活动已有信息")
                                return false
                            } else if (confirm("确定删除这一行嘛？")) {
                                //找到按钮所在行的节点，然后删掉这一行
                                var c = JSON.stringify(this.parentNode.parentNode.innerText)
                                var tId = c.substring(c.indexOf('"') + 1, c.indexOf("\\t"))

                                delete templateInfo[tId]
                                this.parentNode.parentNode.parentNode.removeChild(this.parentNode.parentNode);
                            }
                        }
                        delCell.appendChild(btnDel);  //把删除按钮加入td，别忘了

                        return row; //返回tr数据
                    }

                    templateItemInfo = {}
                    $("#addActivityTemplate")[0].reset()
                    $("#template_table").empty("")
                    layui.form.render();
                    layer.close(layer.index)
                }
            })

            var rewardInfo = {}
            var rewardId = 0
            $("#rewardBtn").on('click', function () {
                var mayselect = document.getElementById("allItemName")
                var index = mayselect.selectedIndex
                var itemIdName = mayselect.options[index].text
                var itemName = itemIdName.substr(itemIdName.indexOf(":") + 1, itemIdName.length)
                var itemCount = $("#rewardCount").val()

                var selectType = document.getElementById("rewardActivityType");
                var typeIndex = selectType.selectedIndex;
                var activityTypeName = selectType.options[typeIndex].text
                var activityType = selectType.value

                var exchangeCount = $("#exchangeCount").val()

                var exchangeTypeSelect = document.getElementById("exchangeTypeItem")
                var exchangeIndex = exchangeTypeSelect.selectedIndex
                var exchangeTypeName = exchangeTypeSelect.options[exchangeIndex].text
                var exchange = exchangeTypeName.substr(exchangeTypeName.indexOf(":") + 1, exchangeTypeName.length)

                if (activityType === "") {
                    alert("请选择活动类型")
                    return false
                } else if (parseInt(activityType) === 4 && (exchangeTypeName === "" || exchangeCount === "")) {
                    alert("请选择兑换消耗并输入消耗数量")
                    return false
                } else if (itemName === '') {
                    alert("请选择道具")
                    return false
                } else if (itemCount === '') {
                    alert("请输入道具数量")
                    return false
                } else {
                    rewardId++
                    rewardInfo [rewardId] = {
                        "activityType": activityType,
                        "activityTypeName": activityTypeName,
                        "itemId": mayselect.value,
                        "itemName": itemName,
                        "itemCount": itemCount,
                        "exchangeTypeName": exchange,
                        "exchangeItem": exchangeTypeSelect.value,
                        "exchangeCount": exchangeCount,
                    }

                    $(document).ready(function () {
                            var tbody = document.getElementById('activity_reward_table1');
                            //遍历一下json数据
                            var rewardValue = Object.values(rewardInfo)
                            var trow = getDataRow(rewardValue[rewardValue.length - 1], rewardId); //定义一个方法,返回tr数据

                            tbody.appendChild(trow);

                        }
                    )

                    function getDataRow(v, rewardId) {
                        var row = document.createElement('tr'); //创建行

                        var idCell = document.createElement('td'); //创建第一列id
                        idCell.innerHTML = rewardId; //填充数据
                        row.appendChild(idCell); //加入行  ，下面类似

                        var activityTypeNameCell = document.createElement('td');//创建第二列name
                        activityTypeNameCell.innerHTML = v.activityTypeName;
                        row.appendChild(activityTypeNameCell);


                        var itemNameCell = document.createElement('td'); //创建第一列id
                        itemNameCell.innerHTML = v.itemName; //填充数据
                        row.appendChild(itemNameCell); //加入行  ，下面类似

                        var itemCountCell = document.createElement('td');//创建第二列name
                        itemCountCell.innerHTML = v.itemCount;
                        row.appendChild(itemCountCell);


                        var exchangeTypeNameCell = document.createElement('td'); //创建第一列id
                        exchangeTypeNameCell.innerHTML = v.exchangeTypeName; //填充数据
                        row.appendChild(exchangeTypeNameCell); //加入行  ，下面类似

                        var exchangeCountCell = document.createElement('td');//创建第二列name
                        exchangeCountCell.innerHTML = v.exchangeCount;
                        row.appendChild(exchangeCountCell);

                        //到这里，json中的数据已经添加到表格中，下面为每行末尾添加删除按钮

                        var delCell = document.createElement('td');//创建第四列，操作列
                        row.appendChild(delCell);
                        var btnDel = document.createElement('input'); //创建一个input控件
                        btnDel.setAttribute('type', 'button'); //type="button"
                        btnDel.setAttribute('value', '删除');
                        btnDel.setAttribute('class', "layui-btn layui-btn-sm layui-btn-danger");

                        //删除操作
                        btnDel.onclick = function () {
                            if (Object.keys(activityLimitInfo) > 0) {
                                alert("活动奖励已被使用不可删除")
                                return false
                            } else if (confirm("确定删除这一行嘛？")) {
                                //找到按钮所在行的节点，然后删掉这一行
                                var c = JSON.stringify(this.parentNode.parentNode.innerText)
                                var infoId = c.substring(c.indexOf('"') + 1, c.indexOf("\\t"))
                                delete rewardInfo[infoId]

                                this.parentNode.parentNode.parentNode.removeChild(this.parentNode.parentNode);
                            }
                        }
                        delCell.appendChild(btnDel);  //把删除按钮加入td，别忘了
                        return row; //返回tr数据

                    }

                    $("#addRewardForm")[0].reset()
                }
            })

            $("#addActivityRewardBtn").on('click', function () {
                if (Object.keys(rewardInfo) <= 0) {
                    alert("没有奖励提交")
                    return false
                } else {
                    $("#activity_reward_table").empty("")
                    layui.form.render();
                    $(document).ready(function () {
                            var tbody = document.getElementById('activity_reward_table');
                            //遍历一下json数据
                            var rewardValue = Object.values(rewardInfo)
                            for (var r = 0; r < rewardValue.length; r++) {
                                var trow = getDataRow(rewardValue[r], Object.keys(rewardInfo)[r]); //定义一个方法,返回tr数据
                                tbody.appendChild(trow);
                            }
                        }
                    )

                    function getDataRow(v, rewardId) {
                        var row = document.createElement('tr'); //创建行

                        var idCell = document.createElement('td'); //创建第一列id
                        idCell.innerHTML = rewardId; //填充数据
                        row.appendChild(idCell); //加入行  ，下面类似

                        var activityTypeNameCell = document.createElement('td');//创建第二列name
                        activityTypeNameCell.innerHTML = v.activityTypeName;
                        row.appendChild(activityTypeNameCell);


                        var itemNameCell = document.createElement('td'); //创建第一列id
                        itemNameCell.innerHTML = v.itemName; //填充数据
                        row.appendChild(itemNameCell); //加入行  ，下面类似

                        var itemCountCell = document.createElement('td');//创建第二列name
                        itemCountCell.innerHTML = v.itemCount;
                        row.appendChild(itemCountCell);


                        var exchangeTypeNameCell = document.createElement('td'); //创建第一列id
                        exchangeTypeNameCell.innerHTML = v.exchangeTypeName; //填充数据
                        row.appendChild(exchangeTypeNameCell); //加入行  ，下面类似

                        var exchangeCountCell = document.createElement('td');//创建第二列name
                        exchangeCountCell.innerHTML = v.exchangeCount;
                        row.appendChild(exchangeCountCell);

                        //到这里，json中的数据已经添加到表格中，下面为每行末尾添加删除按钮

                        var delCell = document.createElement('td');//创建第四列，操作列
                        row.appendChild(delCell);
                        var btnDel = document.createElement('input'); //创建一个input控件
                        btnDel.setAttribute('type', 'button'); //type="button"
                        btnDel.setAttribute('value', '删除');
                        btnDel.setAttribute('class', "layui-btn layui-btn-sm layui-btn-danger");

                        //删除操作
                        btnDel.onclick = function () {
                            if (confirm("确定删除这一行嘛？")) {
                                //找到按钮所在行的节点，然后删掉这一行
                                var c = JSON.stringify(this.parentNode.parentNode.innerText)
                                var infoId = c.substring(c.indexOf('"') + 1, c.indexOf("\\t"))
                                delete rewardInfo[infoId]

                                this.parentNode.parentNode.parentNode.removeChild(this.parentNode.parentNode);
                            }
                        }
                        delCell.appendChild(btnDel);  //把删除按钮加入td，别忘了
                        return row; //返回tr数据
                    }

                    $("#activity_reward_table1").empty("")
                    layui.form.render();
                    layer.close(layer.index)
                }
            })


            var activityLimitInfo = {}
            var limitId = 0
            $("#addActivityLimit").on('click', function () {
                var mayselect = document.getElementById("receiveLimit")
                var index = mayselect.selectedIndex
                var limitName = mayselect.options[index].text

                var limitCount = document.getElementById("limitCount").value
                var activityType = document.getElementById("activityInfoType").value

                for (var i = 0; i < Object.values(activityLimitInfo).length; i++) {
                    if (mayselect.value === Object.values(activityLimitInfo)[i].limitTypeId) {
                        alert("限制类型不可重复选择")
                        return false
                    }
                }

                if (activityType === "") {
                    alert("请选择活动类型")
                    return false
                } else if (limitName === '') {
                    alert("请选择活动限制")
                    return false
                } else if (limitCount === '') {
                    alert("请输入限制数量")
                    return false
                } else if (Object.keys(activityLimitInfo).length >= 10) {
                    alert("一个池子最多可添加十组道具信息")
                    return false
                } else {
                    limitId++
                    activityLimitInfo [limitId] = {
                        "activityType": activityType,
                        "limitTypeId": mayselect.value,
                        "limitName": limitName,
                        "limitCount": limitCount,
                        "extAttr": "",
                        "extAttr2": "",
                    }


                    $(document).ready(function () {

                            var tbody = document.getElementById('activity_limit_table');
                            var limitValue = Object.values(activityLimitInfo)
                            var trow = getDataRow(limitValue[limitValue.length - 1], limitId); //定义一个方法,返回tr数据

                            tbody.appendChild(trow);

                        }
                    )

                    function getDataRow(l, limitId) {
                        var row = document.createElement('tr'); //创建行
                        var limitIdCell = document.createElement('td');//创建第二列name
                        limitIdCell.innerHTML = limitId;
                        row.appendChild(limitIdCell);

                        var limitNameCell = document.createElement('td');//创建第二列name
                        limitNameCell.innerHTML = l.limitName;
                        row.appendChild(limitNameCell);

                        var limitCountCell = document.createElement('td'); //创建第一列id
                        limitCountCell.innerHTML = l.limitCount; //填充数据
                        row.appendChild(limitCountCell); //加入行  ，下面类似

                        //到这里，json中的数据已经添加到表格中，下面为每行末尾添加删除按钮
                        var delCell = document.createElement('td');//创建第四列，操作列
                        row.appendChild(delCell);
                        var btnDel = document.createElement('input'); //创建一个input控件
                        btnDel.setAttribute('type', 'button'); //type="button"
                        btnDel.setAttribute('value', '删除');
                        btnDel.setAttribute('class', "layui-btn layui-btn-sm layui-btn-danger");

                        //删除操作
                        btnDel.onclick = function () {
                            if (confirm("确定删除这一行嘛？")) {
                                //找到按钮所在行的节点，然后删掉这一行
                                var c = JSON.stringify(this.parentNode.parentNode.innerText)
                                var activityInfoId = c.substring(c.indexOf('"') + 1, c.indexOf("\\t"))
                                delete activityLimitInfo[activityInfoId]

                                this.parentNode.parentNode.parentNode.removeChild(this.parentNode.parentNode);
                                $('#activityInfoType').attr("disabled", false).removeClass("layui-btn-disabled");
                                form.render('select');
                            }
                        }
                        delCell.appendChild(btnDel);  //把删除按钮加入td，别忘了
                        return row; //返回tr数据
                    }

                    $('#activityInfoType').attr('disabled', 'true')
                    form.render('select');
                }
            })
            var extAttrInfo = {}
            var extAttrId = 0
            $("#addExtAttr").on('click', function () {
                var activityType = document.getElementById("activityInfoType").value
                var mayselect = document.getElementById("extAttrItemName")
                var index = mayselect.selectedIndex
                var itemIdName = mayselect.options[index].text
                var itemName = itemIdName.substr(itemIdName.indexOf(":") + 1, itemIdName.length)
                var itemId = mayselect.value
                var extAttrCount = 0

                if (Object.values(extAttrInfo).length > 0) {
                    if (parseInt(activityType) === 2) {
                        for (var e = 0; e < Object.values(extAttrInfo).length; e++) {
                            if (itemId === Object.values(extAttrInfo)[e].extAttrIdInfo.split(",")[0]) {
                                alert("一个池子的道具不可重复")
                                return false
                            }
                        }
                    } else {
                        for (var eId = 0; eId < Object.values(extAttrInfo).length; eId++) {
                            if (itemId === Object.values(extAttrInfo)[eId].extAttrIdInfo.split(":")[0]) {
                                alert("一个池子的道具不可重复")
                                return false
                            }
                        }
                    }
                }


                if (parseInt(activityType) === 2) {
                    extAttrCount = document.getElementById("extAttrCount").value
                } else {
                    extAttrCount = document.getElementById("extAttrRandomCount").value + "," + document.getElementById("extAttrMaxCount").value
                }
                if (itemName === "") {
                    alert("请选择捐赠道具")
                    return false
                } else if (parseInt(activityType) === 2 && extAttrCount === '') {
                    alert("请输入道具数量")
                    return false
                } else if (parseInt(activityType) === 3 && ($("#extAttrRandomCount").val() === '' || $("#extAttrMaxCount").val() === '')) {
                    alert("请输入随机数量")
                    return false
                } else if (parseInt($("#extAttrRandomCount").val()) > parseInt($("#extAttrMaxCount").val())) {
                    alert("请输入正确起始数量")
                    return false
                } else {
                    extAttrId++
                    if (parseInt(activityType) === 2) {
                        extAttrInfo[extAttrId] = {
                            "extAttrNameInfo": itemName + "," + extAttrCount,
                            "extAttrIdInfo": itemId + "," + extAttrCount
                        }
                    } else {
                        extAttrInfo[extAttrId] = {
                            "extAttrNameInfo": itemName + "," + extAttrCount,
                            "extAttrIdInfo": itemId + ":" + extAttrCount
                        }
                    }


                    $(document).ready(function () {

                            var tbody = document.getElementById('activity_extAttr_table');
                            var extAttrValue = Object.values(extAttrInfo)
                            var extAttrRow = getDataRow(extAttrValue[extAttrValue.length - 1], extAttrId); //定义一个方法,返回tr数据
                            tbody.appendChild(extAttrRow);

                        }
                    )

                    function getDataRow(extAttrRow, extAttrId) {
                        var row = document.createElement('tr'); //创建行
                        var itemCount = extAttrRow.extAttrNameInfo.substr(extAttrRow.extAttrNameInfo.indexOf(",") + 1, extAttrRow.extAttrNameInfo.length)
                        var itemName = extAttrRow.extAttrNameInfo.split(",")[0]

                        var IDCell = document.createElement('td');//创建第二列name
                        IDCell.innerHTML = extAttrId;
                        row.appendChild(IDCell);

                        var extAttrNameCell = document.createElement('td');//创建第二列name
                        extAttrNameCell.innerHTML = itemName;
                        row.appendChild(extAttrNameCell);

                        var extAttrCountCell = document.createElement('td'); //创建第一列id
                        extAttrCountCell.innerHTML = itemCount; //填充数据
                        row.appendChild(extAttrCountCell); //加入行  ，下面类似

                        //到这里，json中的数据已经添加到表格中，下面为每行末尾添加删除按钮
                        var delCell = document.createElement('td');//创建第四列，操作列
                        row.appendChild(delCell);
                        var btnDel = document.createElement('input'); //创建一个input控件
                        btnDel.setAttribute('type', 'button'); //type="button"
                        btnDel.setAttribute('value', '删除');
                        btnDel.setAttribute('class', "layui-btn layui-btn-sm layui-btn-danger");

                        //删除操作
                        btnDel.onclick = function () {
                            if (confirm("确定删除这一行嘛？")) {
                                //找到按钮所在行的节点，然后删掉这一行
                                var c = JSON.stringify(this.parentNode.parentNode.innerText)
                                var infoId = c.substring(c.indexOf('"') + 1, c.indexOf("\\t"))
                                delete extAttrInfo[infoId]

                                this.parentNode.parentNode.parentNode.removeChild(this.parentNode.parentNode);
                            }
                        }
                        delCell.appendChild(btnDel);  //把删除按钮加入td，别忘了
                        return row; //返回tr数据
                    }
                }
            })


            var extAttrGroupInfo = {}
            var groupId = 0
            $("#addGroup").on('click', function () {
                $(document).ready(function () {
                    var groupList = []
                    var groupNameList = []
                    for (var i = 0; i < Object.values(extAttrInfo).length; i++) {
                        groupList.push(Object.values(extAttrInfo)[i].extAttrIdInfo)
                        groupNameList.push(Object.values(extAttrInfo)[i].extAttrNameInfo)
                    }
                    groupId++
                    extAttrGroupInfo[groupId] = {
                        "groupId": groupId,
                        "groupList": groupList,
                        "groupNameList": groupNameList
                    }
                    var tbody = document.getElementById('activity_group_table');
                    var groupValue = Object.values(extAttrGroupInfo)
                    var groupRow = getDataRow(groupValue[groupValue.length - 1], groupId); //定义一个方法,返回tr数据
                    tbody.appendChild(groupRow);

                })

                function getDataRow(groupRow, groupId) {
                    var row = document.createElement('tr'); //创建行

                    var groupIDCell = document.createElement('td');//创建第二列name
                    groupIDCell.innerHTML = groupId;
                    row.appendChild(groupIDCell);

                    var groupNameCell = document.createElement('td');//创建第二列name
                    groupNameCell.innerHTML = groupRow.groupNameList;
                    row.appendChild(groupNameCell);

                    //到这里，json中的数据已经添加到表格中，下面为每行末尾添加删除按钮
                    var delCell = document.createElement('td');//创建第四列，操作列
                    row.appendChild(delCell);
                    var btnDel = document.createElement('input'); //创建一个input控件
                    btnDel.setAttribute('type', 'button'); //type="button"
                    btnDel.setAttribute('value', '删除');
                    btnDel.setAttribute('class', "layui-btn layui-btn-sm layui-btn-danger");

                    //删除操作
                    btnDel.onclick = function () {
                        if (confirm("确定删除这一行嘛？")) {
                            //找到按钮所在行的节点，然后删掉这一行
                            var c = JSON.stringify(this.parentNode.parentNode.innerText)
                            var infoId = c.substring(c.indexOf('"') + 1, c.indexOf("\\t"))
                            delete extAttrGroupInfo[infoId]

                            this.parentNode.parentNode.parentNode.removeChild(this.parentNode.parentNode);
                        }
                    }
                    delCell.appendChild(btnDel);  //把删除按钮加入td，别忘了
                    return row; //返回tr数据
                }

                $("#activity_extAttr_table").empty("")
                extAttrInfo = {}
            })

            var extAttrGroupId = 0
            var activityExtAttrInfo = {}
            $("#extAttrBtn").on('click', function () {

                if (Object.keys(extAttrGroupInfo).length <= 0) {
                    alert("请添加捐赠池")
                    return false
                } else if (parseInt(document.getElementById("activityInfoType").value) === 2 && $("#extAttrLv").val() === "") {
                    alert("未输入捐献等级")
                    return false
                }

                var activityExtAttr = {"groupList": [], "groupNameList": [], "extAttrLv": 0}
                $(document).ready(function () {
                    for (var i = 0; i < Object.values(extAttrGroupInfo).length; i++) {
                        activityExtAttr["groupList"].push(Object.values(extAttrGroupInfo)[i].groupList)
                        activityExtAttr["groupNameList"].push(Object.values(extAttrGroupInfo)[i].groupNameList)
                        activityExtAttr["extAttrLv"] = $("#extAttrLv").val()
                    }

                    extAttrGroupId++
                    activityExtAttrInfo[extAttrGroupId] = activityExtAttr
                    var tbody = document.getElementById('activity_limit_group');
                    var groupRow = getDataRow(activityExtAttr.groupNameList, activityExtAttr.extAttrLv, extAttrGroupId); //定义一个方法,返回tr数据
                    tbody.appendChild(groupRow);

                })

                function getDataRow(groupRow, extAttrLv, extAttrGroupId) {
                    var row = document.createElement('tr'); //创建行

                    var extAttrGroupIdCell = document.createElement('td');//创建第二列name
                    extAttrGroupIdCell.innerHTML = extAttrGroupId;
                    row.appendChild(extAttrGroupIdCell);

                    var groupCell = document.createElement('td');//创建第二列name
                    groupCell.innerHTML = groupRow;
                    row.appendChild(groupCell);

                    var extAttrLvCell = document.createElement('td');//创建第二列name
                    extAttrLvCell.innerHTML = extAttrLv;
                    row.appendChild(extAttrLvCell);

                    //到这里，json中的数据已经添加到表格中，下面为每行末尾添加删除按钮
                    var delCell = document.createElement('td');//创建第四列，操作列
                    row.appendChild(delCell);
                    var btnDel = document.createElement('input'); //创建一个input控件
                    btnDel.setAttribute('type', 'button'); //type="button"
                    btnDel.setAttribute('value', '删除');
                    btnDel.setAttribute('class', "layui-btn layui-btn-sm layui-btn-danger");

                    //删除操作
                    btnDel.onclick = function () {
                        if (confirm("确定删除这一行嘛？")) {
                            //找到按钮所在行的节点，然后删掉这一行
                            var c = JSON.stringify(this.parentNode.parentNode.innerText)
                            var infoId = c.substring(c.indexOf('"') + 1, c.indexOf("\\t"))
                            delete activityExtAttrInfo[infoId]
                            this.parentNode.parentNode.parentNode.removeChild(this.parentNode.parentNode);
                        }
                    }
                    delCell.appendChild(btnDel);  //把删除按钮加入td，别忘了
                    return row; //返回tr数据
                }

                extAttrGroupInfo = {}
                $('#addActivityExtAttr')[0].reset()
                $("#activity_group_table").empty("")
                layer.close(layer.index);
            })


            var activityInfo = {}
            var activityId = 0
            $("#limitBtn").on("click", function () {
                var activityLimit = {"limitIdInfo": {}, "LimitNameInfo": {}}
                var limitVal = Object.values(activityLimitInfo)

                var selectType = document.getElementById("activityInfoType");
                var typeIndex = selectType.selectedIndex;
                var activityTypeName = selectType.options[typeIndex].text

                var activityTitle = document.getElementById("activityTitle").value
                var activityText = document.getElementById("activityText").value
                var limit = {}
                var nLimit = {}
                for (var i = 0; i < limitVal.length; i++) {
                    limit[i + 1] = limitVal[i].limitCount
                    nLimit[limitVal[i].limitName] = limitVal[i].limitCount
                }
                activityLimit["limitIdInfo"] = limit
                activityLimit["LimitNameInfo"] = nLimit


                var groupList = []
                var groupNameList = []
                var extAttrLv = 0

                if (parseInt($("#activityInfoType").val()) === 2 || parseInt($("#activityInfoType").val()) === 3) {
                    groupNameList = Object.values(activityExtAttrInfo)[Object.keys(activityLimitInfo) - 1].groupNameList
                    groupList = Object.values(activityExtAttrInfo)[Object.keys(activityLimitInfo) - 1].groupList
                    extAttrLv = Object.values(activityExtAttrInfo)[Object.keys(activityLimitInfo) - 1].extAttrLv
                }

                activityId++
                activityInfo[activityId] = {
                    "activityType": $("#activityInfoType").val(),
                    "activityTypeName": activityTypeName,
                    "activityLimit": activityLimit.limitIdInfo,
                    "activityNameLimit": activityLimit.LimitNameInfo,
                    "activityGroupList": groupList,
                    "activityGroupNameLimit": groupNameList,
                    "extAttrLv": extAttrLv,
                    "activityTitle": activityTitle,
                    "activityText": activityText,
                }

                $(document).ready(function () {

                    var activityVal = Object.values(activityInfo)

                    var activityRow = activityVal[activityVal.length - 1]
                    var tbody = document.getElementById('activity_info_table');
                    var groupRow = getDataRow(activityRow, activityId); //定义一个方法,返回tr数据
                    tbody.appendChild(groupRow);
                    //}
                })

                function getDataRow(groupRow, activityId) {
                    var row = document.createElement('tr'); //创建行
                    var activityIdCell = document.createElement('td');//创建第二列name
                    activityIdCell.innerHTML = activityId;
                    row.appendChild(activityIdCell);

                    var activityTitleCell = document.createElement('td');//创建第二列name
                    activityTitleCell.innerHTML = groupRow.activityTitle;
                    row.appendChild(activityTitleCell);

                    var activityTextCell = document.createElement('td');//创建第二列name
                    activityTextCell.innerHTML = groupRow.activityText;
                    row.appendChild(activityTextCell);

                    var activityTypeCell = document.createElement('td');//创建第二列name
                    activityTypeCell.innerHTML = groupRow.activityTypeName;
                    row.appendChild(activityTypeCell);

                    var activityLimitCell = document.createElement('td');//创建第二列name
                    activityLimitCell.innerHTML = JSON.stringify(groupRow.activityNameLimit);
                    row.appendChild(activityLimitCell);

                    var groupCell = document.createElement('td');//创建第二列name
                    groupCell.innerHTML = groupRow.activityGroupNameLimit;
                    row.appendChild(groupCell);

                    var extAttrLvCell = document.createElement('td');//创建第二列name
                    extAttrLvCell.innerHTML = groupRow.extAttrLv;
                    row.appendChild(extAttrLvCell);

                    //到这里，json中的数据已经添加到表格中，下面为每行末尾添加删除按钮
                    var delCell = document.createElement('td');//创建第四列，操作列
                    row.appendChild(delCell);
                    var btnDel = document.createElement('input'); //创建一个input控件
                    btnDel.setAttribute('type', 'button'); //type="button"
                    btnDel.setAttribute('value', '删除');
                    btnDel.setAttribute('class', "layui-btn layui-btn-sm layui-btn-danger");

                    //删除操作
                    btnDel.onclick = function () {
                        if (confirm("确定删除这一行嘛？")) {
                            //找到按钮所在行的节点，然后删掉这一行
                            var c = JSON.stringify(this.parentNode.parentNode.innerText)
                            var infoId = c.substring(c.indexOf('"') + 1, c.indexOf("\\t"))
                            delete activityInfo[infoId]
                            this.parentNode.parentNode.parentNode.removeChild(this.parentNode.parentNode);
                        }
                    }
                    delCell.appendChild(btnDel);  //把删除按钮加入td，别忘了
                    return row; //返回tr数据
                }

                activityLimitInfo = {}
                $('#addActivityForm')[0].reset();
                $("#activity_limit_group").empty("")
                $("#activity_limit_table").empty("")
                $('#activityInfoType').removeClass("layui-btn-disabled").attr("disabled", false);
                layui.form.render();
                layer.closeAll();
            })

            var rewardItem = []
            var rewardCountList = []
            var rewardName = []

            $("#addTaskReward").on("click", function () {
                var rewardItemInfo = []
                var mayselect = document.getElementById("taskRewardName")
                var index = mayselect.selectedIndex
                var itemName = mayselect.options[index].text.split(":")[1]
                var itemId = mayselect.value
                var rewardCount = document.getElementById("taskRewardCount").value

                for (let i of rewardItem) {
                    if (i === mayselect.value) {
                        alert("不可以重复选择")
                        return false
                    }
                }
                if (itemName === "") {
                    alert("未选择奖励道具")
                    return false
                } else if (rewardCount === "") {
                    alert("未输入奖励数量")
                    return false
                } else {
                    rewardItemInfo.push({"itemId": itemId, "itemName": itemName, "itemCount": rewardCount})

                    $(document).ready(function () {

                        var tbody = document.getElementById('activity_task_reward_table');

                        for (var i = 0; i < rewardItemInfo.length; i++) { //遍历一下json数据
                            var trow = getDataRow(rewardItemInfo[i]); //定义一个方法,返回tr数据
                            tbody.appendChild(trow);
                        }
                    })

                    function getDataRow(h) {
                        var row = document.createElement('tr'); //创建行

                        var rewardIdCell = document.createElement('td'); //创建第一列id
                        rewardIdCell.innerHTML = h.itemId; //填充数据
                        row.appendChild(rewardIdCell); //加入行  ，下面类似

                        var rewardNameCell = document.createElement('td');//创建第二列name
                        rewardNameCell.innerHTML = h.itemName;
                        row.appendChild(rewardNameCell);

                        var jobCell = document.createElement('td');//创建第三列job
                        jobCell.innerHTML = h.itemCount;
                        row.appendChild(jobCell);

                        //到这里，json中的数据已经添加到表格中，下面为每行末尾添加删除按钮

                        var delCell = document.createElement('td');//创建第四列，操作列
                        row.appendChild(delCell);
                        var btnDel = document.createElement('input'); //创建一个input控件
                        btnDel.setAttribute('type', 'button'); //type="button"
                        btnDel.setAttribute('value', '删除');
                        btnDel.setAttribute('class', "layui-btn layui-btn-sm layui-btn-danger");

                        //删除操作
                        btnDel.onclick = function () {
                            if (confirm("确定删除这一行嘛？")) {
                                //找到按钮所在行的节点，然后删掉这一行
                                var c = JSON.stringify(this.parentNode.parentNode.innerText)
                                var itemId = c.substring(c.indexOf('"') + 1, c.indexOf("\\t"))
                                var idx = li.indexOf(itemId)

                                rewardItem.splice(idx, 1)
                                rewardName.splice(idx, 1)
                                rewardCountList.splice(idx, 1)

                                this.parentNode.parentNode.parentNode.removeChild(this.parentNode.parentNode);
                            }
                        }
                        delCell.appendChild(btnDel);  //把删除按钮加入td，别忘了

                        return row; //返回tr数据

                    }

                    rewardItem.push(itemId)
                    rewardCountList.push(rewardCount)
                    rewardName.push(itemName)
                }
            })


            var taskRewardInfo = {}
            var taskId = 10227
            $("#taskInfoBtn").on('click', function () {
                var mayselect = document.getElementById("taskTypeInfo")
                var index = mayselect.selectedIndex
                var taskText = mayselect.options[index].text
                var taskTypeId = mayselect.value
                var taskDay = document.getElementById("taskDay").value
                var taskNum = document.getElementById("taskNum").value

                var isStorage = document.getElementById("taskIsStorage").value
                var isStorageIndex = document.getElementById("taskIsStorage").selectedIndex;
                var isStorageName = document.getElementById("taskIsStorage").options[isStorageIndex].label

                if (rewardItem.length <= 0) {
                    alert("未选择任务奖励")
                    return false
                } else if (taskText === "") {
                    alert("未选择任务类型")
                    return false
                } else if (taskDay === "") {
                    alert("任务解锁时间至少一天")
                    return false
                } else if (taskNum === "") {
                    alert("任务所达目标至少为1")
                    return false
                } else if (isStorage === "") {
                    alert("未知任务累积还是达到")
                    return false
                } else {
                    taskId++
                    taskRewardInfo[taskId] = {
                        "taskTypeId": taskTypeId,
                        "taskText": taskText,
                        "taskDay": taskDay,
                        "taskRewardName": rewardName,
                        "taskReward": rewardItem,
                        "taskRewardCount": rewardCountList,
                        "taskNum": taskNum,
                        "isStorage": isStorage,
                        "isStorageName": isStorageName,
                    }


                    $(document).ready(function () {

                        var taskVal = Object.values(taskRewardInfo)

                        var taskRows = taskVal[taskVal.length - 1]

                        var tbody = document.getElementById('activity_task_table');
                        var taskRow = getDataRow(taskRows, taskId); //定义一个方法,返回tr数据
                        tbody.appendChild(taskRow);
                        //}
                    })

                    function getDataRow(taskRow, taskId) {
                        var row = document.createElement('tr'); //创建行
                        var taskIdCell = document.createElement('td');//创建第二列name
                        taskIdCell.innerHTML = taskId;
                        row.appendChild(taskIdCell);

                        var taskTextCell = document.createElement('td');//创建第二列name
                        taskTextCell.innerHTML = taskRow.taskText;
                        row.appendChild(taskTextCell);

                        var taskRewardNameCell = document.createElement('td');//创建第二列name
                        taskRewardNameCell.innerHTML = taskRow.taskRewardName;
                        row.appendChild(taskRewardNameCell);

                        var rewardCountListCell = document.createElement('td');//创建第二列name
                        rewardCountListCell.innerHTML = taskRow.taskRewardCount;
                        row.appendChild(rewardCountListCell);

                        var taskNumCell = document.createElement('td');//创建第二列name
                        taskNumCell.innerHTML = taskRow.taskNum;
                        row.appendChild(taskNumCell);

                        var isStorageCell = document.createElement('td');//创建第二列name
                        isStorageCell.innerHTML = taskRow.isStorageName;
                        row.appendChild(isStorageCell);

                        //到这里，json中的数据已经添加到表格中，下面为每行末尾添加删除按钮
                        var delCell = document.createElement('td');//创建第四列，操作列
                        row.appendChild(delCell);
                        var btnDel = document.createElement('input'); //创建一个input控件
                        btnDel.setAttribute('type', 'button'); //type="button"
                        btnDel.setAttribute('value', '删除');
                        btnDel.setAttribute('class', "layui-btn layui-btn-sm layui-btn-danger");

                        //删除操作
                        btnDel.onclick = function () {
                            if (confirm("确定删除这一行嘛？")) {
                                //找到按钮所在行的节点，然后删掉这一行
                                var c = JSON.stringify(this.parentNode.parentNode.innerText)
                                var infoId = c.substring(c.indexOf('"') + 1, c.indexOf("\\t"))
                                delete taskRewardInfo[infoId]
                                this.parentNode.parentNode.parentNode.removeChild(this.parentNode.parentNode);
                            }
                        }
                        delCell.appendChild(btnDel);  //把删除按钮加入td，别忘了
                        return row; //返回tr数据
                    }

                    $('#addTaskForm')[0].reset();
                    $("#activity_task_reward_table").empty("")
                    layer.close(layer.index);
                }
            })


            $("#addActivityGroup").on('click', function () {
                var activityType = document.getElementById("activityInfoType").value
                if (parseInt(activityType) === 2) {
                    $('#extAttrRandomCount').addClass("layui-btn-disabled").attr("disabled", true);
                    $('#extAttrMaxCount').addClass("layui-btn-disabled").attr("disabled", true);
                    $('#extAttrCount').removeClass("layui-btn-disabled").attr("disabled", false);
                    $('#extAttrLv').removeClass("layui-btn-disabled").attr("disabled", false);
                    layer.open({
                        type: 1,
                        content: $("#addActivityExtAttr"), //这里content是一个普通的String
                        area: ["900px", '800px'],//表单大小
                    })
                    // 下拉框
                    let extAttrStr = "<option value='' name='allItemName'></option>";
                    for (let i of allItemInfo) {
                        //组装数据
                        extAttrStr += "<option value='" + i.itemId + "' name='itemName'>" + i.itemId + ":" + i.name + "</option>";
                    }
                    //jquery赋值方式
                    $("#extAttrItemName").html(extAttrStr);
                    //渲染select
                    form.render();

                } else if (parseInt(activityType) === 3) {
                    layer.open({
                        type: 1,
                        content: $("#addActivityExtAttr"), //这里content是一个普通的String
                        area: ["900px", '800px'],//表单大小
                    })
                    $('#extAttrCount').addClass("layui-btn-disabled").attr("disabled", true);
                    $('#extAttrLv').addClass("layui-btn-disabled").attr("disabled", true);
                    $('#extAttrRandomCount').removeClass("layui-btn-disabled").attr("disabled", false);
                    $('#extAttrMaxCount').removeClass("layui-btn-disabled").attr("disabled", false);
                    //jquery赋值方式
                    let extAttrStr2 = "<option value='' name='itemName'></option>";
                    for (var e = 0; e < Object.values(templateInfo)[0].extAttr.length; e++) {
                        //组装数据
                        extAttrStr2 += "<option value='" + Object.values(templateInfo)[0].extAttr[e] + "' name='itemName'>" + Object.values(templateInfo)[0].extAttr[e] + ":" + Object.values(templateInfo)[0].extAttrName[e] + "</option>";
                    }
                    $("#extAttrItemName").html(extAttrStr2);
                    //渲染select
                    form.render();

                } else {
                    alert("其他活动类型不可添加掉落捐赠池")
                    return false
                }
            })


            form.on('select(rewardActivityType)', function (data) {

                var activityType = data.value;

                if (parseInt(activityType) === 4) {

                    $('#exchangeCount').attr("readonly", false);

                    $('#exchangeTypeItem').attr("disabled", false).removeClass("layui-btn-disabled");

                    let str = "<option value='' name='itemName'></option>";
                    for (var i = 0; i < Object.values(templateInfo)[0].extAttr.length; i++) {
                        //组装数据
                        str += "<option value='" + Object.values(templateInfo)[0].extAttr[i] + "' name='itemName'>" + Object.values(templateInfo)[0].extAttr[i] + ":" + Object.values(templateInfo)[0].extAttrName[i] + "</option>";

                    }
                    //jquery赋值方式
                    $("#exchangeTypeItem").html(str);
                    //渲染select
                    form.render();
                } else {
                    $('#exchangeCount').attr("readonly", "true");
                    $('#exchangeTypeItem').attr('disabled', 'true')
                    form.render('select');
                }
            });

            $("#addNewTemplateBtn").on('click', function () {
                if (Object.keys(templateInfo).length >= 1) {
                    alert("已有新一期活动模板信息")
                    return false
                } else {
                    layer.open({
                        type: 1,
                        content: $("#addActivityTemplate"), //这里content是一个普通的String
                        area: ["900px", '800px'],//表单大小
                    })
                }

            })

            $("#activityRewardBtn").on('click', function () {
                if (Object.keys(templateInfo) <= 0) {
                    alert("未添加活动模板")
                    return false
                } else {
                    let rActivityStr = "<option value='' name='rewardActivityType'></option>"
                    var templateValue = Object.values(templateInfo)

                    for (var i = 0; i < Object.values(templateValue)[0].activityList.length; i++) {
                        rActivityStr += "<option value='" + Object.values(templateValue)[0].activityList[i] + "' name='rewardActivityType'>" + Object.values(templateValue)[0].activityListName[i] + "</option>";
                    }
                    $("#rewardActivityType").html(rActivityStr);
                    $("#activityInfoType").html(rActivityStr);
                    form.render();

                    layer.open({
                        type: 1,
                        content: $("#addRewardForm"), //这里content是一个普通的String
                        area: ["900px", '800px'],//表单大小
                    })
                }

            })
            $("#addActivityBtn").on('click', function () {
                if (Object.keys(templateInfo) <= 0) {
                    alert("未添加活动模板")
                    return false
                } else if (Object.keys(rewardInfo) <= 0) {
                    alert("未添加奖励信息")
                } else {
                    layer.open({
                        type: 1,
                        content: $("#addActivityForm"), //这里content是一个普通的String
                        area: ["900px", '800px'],//表单大小
                    })
                }
            })
            $("#addTaskBtn").on('click', function () {
                if (Object.keys(templateInfo) <= 0) {
                    alert("未添加活动模板")
                    return false
                } else {
                    let taskStr = "<option value='' name='itemName'></option>";
                    for (var e = 0; e < Object.values(templateInfo)[0].extAttr.length; e++) {
                        //组装数据
                        taskStr += "<option value='" + Object.values(templateInfo)[0].extAttr[e] + "' name='itemName'>" + Object.values(templateInfo)[0].extAttr[e] + ":" + Object.values(templateInfo)[0].extAttrName[e] + "</option>";
                    }

                    //jquery赋值方式
                    $("#taskRewardName").html(taskStr);
                    form.render();

                    layer.open({
                        type: 1,
                        content: $("#addTaskForm"), //这里content是一个普通的String
                        area: ["900px", '800px'],//表单大小
                    })
                }
            })

            // 表单提交
            form.on('submit(btnSubmit)', function (data) {

                if (Object.values(rewardInfo).length <= 0) {
                    alert("请添加活动奖励")
                    return false
                } else if (Object.keys(activityInfo).length <= 0) {
                    alert("未添加活动信息")
                    return false
                } else {
                    $.ajax({
                        type: "POST",
                        url: "/cms/operate/addActivity/",
                        data: {
                            "rewardInfo": JSON.stringify(rewardInfo),
                            "activityInfo": JSON.stringify(activityInfo),
                            "taskRewardInfo": JSON.stringify(taskRewardInfo),
                            "activityTemplateInfo": JSON.stringify(templateInfo),
                        },
                        dataType: "JSON",
                        success: function (res) { 　 // 请求被成功响应之后会做的事
                            alert(res.message)
                        }
                    });
                }
            });


            //头工具栏事件
            table.on('toolbar(activation)', function (obj) {//监听的是<table class="layui-hide" id="users" lay-filter="users"></table>
                if (obj.event === 'add') {
                    layer.open({
                        type: 1,
                        content: $("#addForm"), //这里content是一个普通的String
                        area: ["1000px", '1000px'],//表单大小
                    })
                }
            });

            $.ajaxSetup({
                data: {csrfmiddlewaretoken: '{{ csrf_token }}'}
            })

        })
        ;

    </script>
{% endblock %}